# C^ 语言关键字规范

本文档详细定义 C^ 语言的所有保留关键字，包括其语义、用法和示例。

## 1. 核心关键字

| 关键字          | 说明                                      |
| :-------------- | :---------------------------------------- |
| **`func`**      | 函数声明关键字                            |
| **`class`**     | 类定义关键字                              |
| **`struct`**    | 结构体定义关键字                          |
| **`enum`**      | 枚举定义关键字                            |
| **`union`**     | 联合体定义关键字                          |
| **`interface`** | 接口定义关键字                            |
| **`self`**      | **当前实例引用**。                        |
| **`late`**      | 延迟初始化关键字，用于栈上预留空间        |
| **`new`**       | 堆内存分配                                |
| **`delete`**    | 堆内存释放 / 删除函数定义                 |
| **`var`**       | 可变变量声明 (支持类型推导)               |
| **`let`**       | 不可变变量声明 (支持类型推导)，运行时常量 |
| **`const`**     | 编译期常量声明 (类似 static constexpr)    |
| **`static`**    | 静态存储期声明                            |
| **`where`**     | 泛型约束子句                              |
| **`requires`**  | 泛型结构性约束 (Concept 风格)             |
| **`concept`**   | 约束命名 (编译期)                         |

## 2. 控制流关键字

| 关键字         | 说明                                           |
| :------------- | :--------------------------------------------- |
| **`if`**       | 条件语句                                       |
| **`else`**     | 条件语句分支                                   |
| **`match`**    | 模式匹配语句 (替代 switch)                     |
| **`case`**     | 模式匹配分支关键字 (用于显式分支)              |
| **`default`**  | 默认分支关键字 (可用于 match 或 context)       |
| **`for`**      | 循环语句                                       |
| **`while`**    | 循环语句                                       |
| **`do`**       | 循环语句                                       |
| **`break`**    | 跳出循环                                       |
| **`continue`** | 继续下一次循环                                 |
| **`return`**   | 返回语句                                       |
| **`goto`**     | 跳转语句                                       |
| **`try`**      | 异常处理块 / Result 传播操作符                 |
| **`catch`**    | 异常捕获块                                     |
| **`throw`**    | 抛出异常                                       |
| **`noexcept`** | **无异常说明**。声明函数不会抛出异常。         |
| **`defer`**    | **延迟执行**。退出作用域时执行，用于资源清理。 |
| **`await`**    | 等待协程或 Awaitable 对象                      |
| **`import`**   | 导入模块                                       |
| **`module`**   | 模块声明                                       |
| **`internal`** | 包/项目内可见性修饰符                          |
| **`as`**       | 别名关键字 (用于 import 或类型转换)            |
| **`using`**    | 引入命名空间或符号                             |

## 3. 访问修饰符与存储类

| 关键字          | 说明                        |
| :-------------- | :-------------------------- |
| **`public`**    | 公开访问                    |
| **`private`**   | 私有访问                    |
| **`protected`** | 保护访问                    |
| **`static`**    | 静态成员                    |
| **`virtual`**   | 虚函数                      |
| **`abstract`**  | 抽象类/方法                 |
| **`final`**     | 密封类/方法，禁止继承或重写 |
| **`override`**  | 重写基类方法                |
| **`extern`**    | 外部链接                    |

## 4. 类型相关关键字

| 关键字         | 说明                                                                              |
| :------------- | :-------------------------------------------------------------------------------- |
| **`void`**     | 空类型                                                                            |
| **`sbyte`**    | 有符号8位整数                                                                     |
| **`byte`**     | 无符号8位整数 (原始数据)                                                          |
| **`short`**    | 16位整数                                                                          |
| **`ushort`**   | 无符号16位整数                                                                    |
| **`int`**      | 32位整数                                                                          |
| **`uint`**     | 无符号32位整数                                                                    |
| **`long`**     | 64位整数                                                                          |
| **`ulong`**    | 无符号64位整数                                                                    |
| **`float`**    | 单精度浮点数                                                                      |
| **`double`**   | 双精度浮点数                                                                      |
| **`fp16`**     | 半精度浮点数 (IEEE 754 Binary16)。*注：依赖硬件支持，无硬件支持时软模拟*          |
| **`bf16`**     | 脑浮点数 (Brain Floating Point, BFloat16)。*注：依赖硬件支持，无硬件支持时软模拟* |
| **`bool`**     | 布尔类型                                                                          |
| **`char`**     | Unicode字符 (32位)                                                                |
| **`string`**   | **已移除** (现为标准库类型 `std.string`)                                          |
| **`cstring`**  | **已移除** (现为标准库类型 `std.cstring`)                                         |
| **`true`**     | 布尔真值                                                                          |
| **`false`**    | 布尔假值                                                                          |
| **`null`**     | 空值                                                                              |
| **`sizeof`**   | 获取类型或变量大小                                                                |
| **`typeof`**   | **获取类型**。编译期获取表达式的类型。                                            |
| **`@`**        | **反射操作符**。获取类型或实体的元数据。                                          |
| **`operator`** | **运算符重载**。定义自定义操作符行为。                                            |
| **`mutable`**  | **可变修饰符**。用于 lambda 捕获或不可变对象中的可变成员。                        |
| **`comptime`** | **编译期执行**。用于标记编译期常量、代码块或循环。                                |

## 5. 特殊符号关键字

| 符号     | 说明                                   |
| :------- | :------------------------------------- |
| **`^`**  | 指针类型后缀 / 解引用(后缀)            |
| **`&`**  | 取地址(前缀) / 引用类型后缀 / 引用捕获 |
| **`?`**  | 可空类型标记 / Result传播(后缀)        |
| **`!`**  | 只读引用标记 (用于参数)                |
| **`~`**  | 移动语义标记 (后缀)                    |
| **`=>`** | 单表达式函数/属性简写                  |

---

## 6. 关键字详细说明

### 6.1 self 关键字

在 C^ 中，我们使用 **`self`** 来指代当前对象实例，取代了 C++ 中的 `this`。

*   **语义**：`self` 代表对象本身（引用或值），而不是指针。
*   **显式声明**：在成员函数参数列表中，推荐显式写出 `self` 来标记函数的修饰符（虽然为了兼容性也支持隐式，但显式更符合 C^ 风格）。
*   **操作符重载**：在操作符重载中，使用 `self` 可以清晰地表达左操作数或右操作数。

```cpp
class Vector {
    int x;
    int y;

public:
    // 显式 self 声明
    func length(self!) -> float {
        return sqrt(self.x * self.x + self.y * self.y);
    }

    // 操作符重载：成员函数形式
    // self 指代左操作数
    func operator+(self!, Vector other) -> Vector {
        return Vector(self.x + other.x, self.y + other.y);
    }
}
```

### 6.2 base 关键字

`base` 用于引用基类，有两种用法：

**1. 调用基类构造函数：**
```cpp
class Derived : Base {
    public Derived(int x) : base(x) {
        // 子类构造逻辑
    }
}
```

**2. 调用基类方法：**
```cpp
override func draw() {
    base.draw();  // 先调用基类实现
    // 子类扩展逻辑
}
```

### 6.3 new 和 delete 关键字

**new 用于动态内存分配：**
```cpp
// 分配单个对象
int^ p = new int(42);

// 分配数组（返回切片）
int[] arr = new int[10];

// 分配并初始化
Point^ pt = new Point(1.0, 2.0);
```

**delete 用于释放内存：**
```cpp
// 释放单个对象
delete p;

// 释放数组
delete arr;
```

### 6.4 late 关键字

`late` 用于声明延迟初始化的变量，变量在声明时不构造，在使用前必须初始化。

```cpp
class FileReader {
    late File file;
    
    func open(string path) {
        file = File(path);  // 延迟初始化
    }
}
```

### 6.5 defer 关键字

`defer` 用于注册在作用域结束时执行的代码，常用于资源清理。

```cpp
func processFile(string path) {
    var file = File.open(path);
    defer file.close();  // 函数返回时自动关闭
    
    // 处理文件...
}  // file.close() 在这里自动调用
```

## 7. 已移除的关键字

以下关键字在 C^ 中被移除，使用替代方案：

| C/C++ 关键字 | C^ 替代方案 | 说明                     |
| ------------ | ----------- | ------------------------ |
| `this`       | `self`      | 统一使用 `self`          |
| `switch`     | `match`     | 更安全的模式匹配         |
| `case`       | `=>`        | match 表达式使用箭头语法 |
| `default`    | `_`         | 通配符模式               |
| `typedef`    | `typealias` | 类型别名                 |
| `template`   | `<> `       | 泛型使用尖括号           |
| `typename`   | 直接写类型  | 简化语法                 |
| `super`      | `base`      | 统一使用 `base`          |
| `export`     | `public`    | 使用 `public` 导出       |
| `namespace`  | `module`    | 命名空间由模块系统决定   |

## 8. 关键字保留规则

1. **不能用作标识符**：所有关键字都不能作为变量名、函数名等
2. **区分大小写**：关键字必须小写（如 `Func` 不是关键字）
3. **上下文关键字**：无，所有关键字都是保留字

## 9. 版本历史

| 版本 | 变更                                 |
| ---- | ------------------------------------ |
| 1.0  | 初始关键字集合                       |
| 1.1  | 移除 `super`，统一使用 `base`        |
| 1.2  | 移除 `export`，统一使用 `public`     |
| 1.3  | 移除 `namespace`，使用 `module` 系统 |
