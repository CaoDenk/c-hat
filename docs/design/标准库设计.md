# 标准库设计

## 日期
2026-02-16

## 概述

本文档定义 c-hat 标准库的设计和结构。

---

## 标准库目录结构

```
stdlib/
├── std/
│   ├── io.ch       # 输入输出
│   ├── string.ch   # 字符串处理
│   ├── math.ch     # 数学函数
│   └── ...
└── sys/
    ├── windows.ch  # Windows 平台绑定
    └── ...
```

---

## 标准库查找路径

编译器查找标准库的顺序：
1. 用户通过 `-I` 选项指定的路径
2. 当前工作目录
3. 编译器安装目录下的 `stdlib/` 目录
4. 环境变量 `CHAT_STDLIB_PATH` 指定的目录

---

## 简单标准库实现 - std/io.ch

### 初始版本（使用 Win32 API）

```c
// std/io.ch

extern "C" {
    const long STD_OUTPUT_HANDLE = -11;
    const long STD_INPUT_HANDLE = -10;
    
    func GetStdHandle(long nStdHandle) -> void^;
    
    func WriteConsoleA(
        void^ hConsoleOutput,
        void^ lpBuffer,
        long nNumberOfCharsToWrite,
        long^ lpNumberOfCharsWritten,
        void^ lpReserved
    ) -> bool;
    
    func ReadConsoleA(
        void^ hConsoleInput,
        void^ lpBuffer,
        long nNumberOfCharsToRead,
        long^ lpNumberOfCharsRead,
        void^ lpReserved
    ) -> bool;
}

namespace std {
    // 输出字符串到控制台（不带换行）
    func print(byte^ s) {
        void^ hStdOut = GetStdHandle(-11);
        long len = 0;
        while (s[len] != 0) {
            len++;
        }
        long written = 0;
        WriteConsoleA(hStdOut, s, len, ^written, null);
    }
    
    // 输出字符串到控制台（带换行）
    func println(byte^ s) {
        print(s);
        print("\n");
    }
}
```

### 使用示例

```c
// 使用标准库
import "std/io"

func main() -> int {
    std::println("Hello from stdlib!");
    return 0;
}
```

---

## 导入语句设计

```c
// 导入整个模块
import "std/io"

// 使用命名空间访问
std::println("Hello");

// 或者导入命名空间
using "std"

println("Hello");
```

---

## 实现阶段

### 阶段 1：基础结构
- [ ] 设计 import 语句解析
- [ ] 标准库查找路径实现
- [ ] 创建 std/io.ch 初始版本

### 阶段 2：基础 I/O
- [ ] print/println 函数（Win32 API）
- [ ] readLine 函数（Win32 API）

### 阶段 3：更多模块
- [ ] std/string - 字符串操作
- [ ] std/math - 数学函数
- [ ] sys/windows - 更多 Windows API 绑定
