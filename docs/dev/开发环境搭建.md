# C^ (C-Hat) 开发环境搭建

## 1. 系统要求

### 1.1 操作系统

- **Windows**：Windows 10 或 Windows 11
- **Linux**：Ubuntu 20.04 或更高版本，或其他支持 LLVM 的 Linux 发行版
- **macOS**：macOS 12 (Monterey) 或更高版本

### 1.2 硬件要求

- **CPU**：至少 4 核心
- **内存**：至少 8GB RAM
- **存储**：至少 50GB 可用空间

## 2. 必要工具和依赖项

| 工具/依赖项 | 版本要求 | 用途 | 安装命令 |
|-------------|----------|------|----------|
| CMake | 3.16+ | 构建系统 | [官网下载](https://cmake.org/download/) |
| LLVM | 18.0+ | 代码生成与优化 | [官网下载](https://llvm.org/releases/download.html) |
| Clang | 18.0+ | C/C++ 编译器 | 随 LLVM 一起安装 |
| Python | 3.8+ | 辅助脚本 | [官网下载](https://www.python.org/downloads/) |
| Git | 2.20+ | 版本控制 | [官网下载](https://git-scm.com/downloads) |
| Visual Studio | 2022+ (Windows) | IDE 和构建工具链 | [官网下载](https://visualstudio.microsoft.com/downloads/) |
| Xcode Command Line Tools | 14+ (macOS) | 构建工具链 | `xcode-select --install` |

## 3. 安装步骤

### 3.1 Windows 平台

#### 3.1.1 安装 Visual Studio 2022

1. 下载并安装 [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/)
2. 在安装过程中，选择 "使用 C++ 的桌面开发" 工作负载
3. 确保选中以下组件：
   - MSVC v143 - VS 2022 C++ x64/x86 生成工具
   - Windows 10/11 SDK
   - C++ CMake 工具

#### 3.1.2 安装 LLVM

1. 下载并安装 [LLVM 18.0+](https://llvm.org/releases/download.html)
2. 在安装过程中，确保将 LLVM 添加到系统 PATH 中

#### 3.1.3 安装 Git

1. 下载并安装 [Git](https://git-scm.com/downloads)
2. 在安装过程中，选择默认选项

#### 3.1.4 安装 Python

1. 下载并安装 [Python 3.8+](https://www.python.org/downloads/)
2. 在安装过程中，确保将 Python 添加到系统 PATH 中

### 3.2 Linux 平台 (Ubuntu 20.04+)

#### 3.2.1 安装必要的依赖项

```bash
# 更新包列表
sudo apt update

# 安装构建工具
sudo apt install build-essential cmake git python3 python3-pip

# 安装 LLVM 和 Clang
sudo apt install llvm-18 clang-18 lld-18
```

#### 3.2.2 验证安装

```bash
# 验证 CMake 版本
cmake --version

# 验证 LLVM 版本
llvm-config-18 --version

# 验证 Clang 版本
clang-18 --version
```

### 3.3 macOS 平台

#### 3.3.1 安装 Xcode Command Line Tools

```bash
xcode-select --install
```

#### 3.3.2 安装 Homebrew

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

#### 3.3.3 安装必要的依赖项

```bash
# 安装 CMake、Git 和 Python
brew install cmake git python

# 安装 LLVM 和 Clang
brew install llvm
```

#### 3.3.4 配置环境变量

将以下内容添加到 `~/.zshrc` 或 `~/.bashrc` 文件中：

```bash
# LLVM 路径
export PATH="/usr/local/opt/llvm/bin:$PATH"
export LDFLAGS="-L/usr/local/opt/llvm/lib"
export CPPFLAGS="-I/usr/local/opt/llvm/include"
```

## 4. 克隆项目

### 4.1 克隆代码库

```bash
# 克隆项目
git clone https://github.com/yourusername/c-hat.git

# 进入项目目录
cd c-hat
```

### 4.2 查看项目结构

```bash
ls -la
```

## 5. 构建项目

### 5.1 使用 CMake 构建

#### 5.1.1 Windows 平台

```powershell
# 创建构建目录
mkdir build
cd build

# 配置项目
cmake .. -G "Visual Studio 17 2022" -A x64

# 构建项目
cmake --build . --config Debug
```

#### 5.1.2 Linux/macOS 平台

```bash
# 创建构建目录
mkdir -p build
cd build

# 配置项目
cmake .. -DCMAKE_BUILD_TYPE=Debug

# 构建项目
cmake --build .
```

### 5.2 构建选项

| 选项 | 描述 | 默认值 |
|------|------|--------|
| CMAKE_BUILD_TYPE | 构建类型 (Debug/Release) | Debug |
| LLVM_DIR | LLVM 安装目录 | 自动检测 |
| CLANG_DIR | Clang 安装目录 | 自动检测 |

## 6. 运行测试

### 6.1 运行单元测试

```bash
# 进入构建目录
cd build

# 运行测试
ctest -V
```

### 6.2 运行示例

```bash
# 进入构建目录
cd build

# 运行解析器测试
./Debug/c_hat_parser.exe # Windows
./c_hat_parser # Linux/macOS
```

## 7. 开发工具配置

### 7.1 Visual Studio Code

#### 7.1.1 安装必要的扩展

- [C/C++](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)
- [CMake Tools](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools)
- [LLVM](https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-llvm)

#### 7.1.2 配置 settings.json

```json
{
    "cmake.buildDirectory": "${workspaceFolder}/build",
    "cmake.generator": "Visual Studio 17 2022",
    "cmake.configureSettings": {
        "LLVM_DIR": "path/to/llvm/lib/cmake/llvm"
    },
    "C_Cpp.default.compilerPath": "path/to/clang.exe"
}
```

### 7.2 Visual Studio 2022

#### 7.2.1 打开项目

1. 启动 Visual Studio 2022
2. 选择 "打开本地文件夹"
3. 导航到 c-hat 项目目录并打开
4. Visual Studio 会自动检测 CMake 项目

#### 7.2.2 配置项目

1. 在 "CMake 设置" 中，确保选择了正确的 LLVM 路径
2. 选择 "Debug" 或 "Release" 配置
3. 点击 "生成" 按钮构建项目

## 8. 常见问题和解决方案

### 8.1 LLVM 找不到

**问题**：CMake 无法找到 LLVM 安装。

**解决方案**：
- 确保 LLVM 已正确安装
- 在 CMake 命令中指定 LLVM_DIR：
  ```bash
  cmake .. -DLLVM_DIR=path/to/llvm/lib/cmake/llvm
  ```

### 8.2 编译错误

**问题**：编译时出现错误。

**解决方案**：
- 确保所有依赖项都已正确安装
- 检查 CMake 配置是否正确
- 查看详细的错误信息并解决问题

### 8.3 构建失败

**问题**：构建过程失败。

**解决方案**：
- 清理构建目录并重新构建：
  ```bash
  rm -rf build
  mkdir -p build
  cd build
  cmake ..
  cmake --build .
  ```

## 9. 总结

通过以上步骤，您应该已经成功搭建了 C^ 语言的开发环境。如果您在搭建过程中遇到任何问题，请参考常见问题和解决方案部分，或查阅项目的 GitHub Issues 页面。

### 9.1 下一步

- 阅读 [核心模块设计文档](核心模块设计.md) 了解项目的核心模块
- 阅读 [测试策略文档](测试策略.md) 了解如何编写和运行测试
- 阅读 [构建系统文档](构建系统.md) 了解项目的构建系统

---

*文档版本：1.0.0*
*最后更新：2026-02-05*
