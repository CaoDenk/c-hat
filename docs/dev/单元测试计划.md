# C-Hat 单元测试计划文档

## 目录
1. [测试目标](#测试目标)
2. [测试框架](#测试框架)
3. [测试内容](#测试内容)
4. [测试文件结构](#测试文件结构)

---

## 测试目标

确保 C-Hat 编译器的各个模块能够正确工作，覆盖所有已实现的功能点。

---

## 测试框架

使用 **Catch2** 作为测试框架。

---

## 测试内容

### 1. 词法分析器测试 (Lexer)

- [ ] 测试所有基础类型关键字识别
- [ ] 测试所有操作符识别
- [ ] 测试标识符和数字识别
- [ ] 测试字符串字面量识别
- [ ] 测试注释识别

### 2. 解析器测试 (Parser)

#### 2.1 基础类型解析
- [ ] int, float, double, bool, char
- [ ] byte, sbyte, short, ushort, uint, long, ulong
- [ ] void 类型

#### 2.2 复合类型解析
- [ ] 数组类型 `T[N]`
- [ ] 切片类型 `T[]`
- [ ] 指针类型 `T^`
- [ ] 元组类型 `(T1, T2, ...)`
- [ ] 类类型
- [ ] 结构体类型

#### 2.3 变量声明解析
- [ ] 显式类型声明 `int x;`
- [ ] var 声明 `var x = 42;`
- [ ] let 声明 `let pi = 3.14;`
- [ ] late 声明 `late int x;`
- [ ] const 声明 `const int x = 10;`

#### 2.4 函数声明解析
- [ ] 普通函数 `func foo(int a) -> int { ... }`
- [ ] 箭头函数 `func foo(int a) -> int => a * 2;`
- [ ] 函数参数
- [ ] 函数返回类型

#### 2.5 类声明解析
- [ ] 基础类声明
- [ ] 构造函数 `ClassName(...)`
- [ ] 析构函数 `~ClassName()`
- [ ] 成员函数
- [ ] 成员变量

#### 2.6 语句解析
- [ ] if-else 语句
- [ ] while 循环
- [ ] for 循环
- [ ] return 语句
- [ ] break/continue 语句
- [ ] 表达式语句

#### 2.7 表达式解析
- [ ] 二元表达式
- [ ] 一元表达式
- [ ] 函数调用
- [ ] 成员访问
- [ ] 数组下标访问
- [ ] new 表达式
- [ ] delete 表达式

#### 2.8 异常处理解析
- [ ] try-catch 语句
- [ ] throw 语句
- [ ] catch(...) 兜底

#### 2.9 defer 语句解析
- [ ] defer 基础语法

### 3. 语义分析器测试 (Semantic Analyzer)

#### 3.1 类型检查
- [ ] 基础类型检查
- [ ] 类型兼容性检查
- [ ] 类型推导检查

#### 3.2 变量声明语义分析
- [ ] 显式类型变量
- [ ] var 变量推导
- [ ] let 变量推导
- [ ] late 变量
- [ ] const 变量

#### 3.3 函数声明语义分析
- [ ] 函数签名检查
- [ ] 返回类型检查
- [ ] 参数类型检查

#### 3.4 类声明语义分析
- [ ] 成员变量检查
- [ ] 成员函数检查
- [ ] 构造函数识别
- [ ] 析构函数识别

#### 3.5 表达式语义分析
- [ ] 二元表达式类型推导
- [ ] 一元表达式类型推导
- [ ] 函数调用类型检查
- [ ] 成员访问类型检查
- [ ] 数组下标类型检查
- [ ] new 表达式类型推导
- [ ] 数组字面量类型推导

#### 3.6 异常处理语义分析
- [ ] try-catch 类型检查
- [ ] throw 表达式类型检查

### 4. LLVM 代码生成测试 (Code Generator)

#### 4.1 基础代码生成
- [ ] 基础类型生成
- [ ] 变量声明生成
- [ ] 函数生成
- [ ] 函数调用生成

#### 4.2 类系统代码生成
- [ ] 类结构体类型生成
- [ ] 构造函数代码生成
- [ ] 析构函数代码生成
- [ ] 成员函数代码生成
- [ ] self 指针处理

#### 4.3 表达式代码生成
- [ ] 算术表达式生成
- [ ] 逻辑表达式生成
- [ ] 函数调用生成
- [ ] 成员访问生成
- [ ] 数组下标生成
- [ ] new 表达式生成
- [ ] delete 表达式生成
- [ ] 数组字面量生成

#### 4.4 控制流代码生成
- [ ] if-else 生成
- [ ] while 生成
- [ ] for 生成
- [ ] return 生成

---

## 测试文件结构

```
tests/
├── CMakeLists.txt
├── parser_test.cpp         # 解析器测试（已存在）
├── semantic_test.cpp       # 语义分析器测试（已存在）
├── class_test.cpp          # 类系统测试（已存在）
├── tuple_test.cpp          # 元组测试（已存在）
├── types/
│   └── TypeSystemTest.cpp  # 类型系统测试
├── parser/                 # 解析器 Catch2 测试
│   ├── CMakeLists.txt
│   └── ParserTest.cpp
├── semantic/              # 语义分析 Catch2 测试
│   ├── CMakeLists.txt
│   └── SemanticTest.cpp
├── class_system/          # 类系统 Catch2 测试
│   ├── CMakeLists.txt
│   └── ClassTest.cpp
├── exception/             # 异常处理 Catch2 测试
│   ├── CMakeLists.txt
│   └── ExceptionTest.cpp
├── array/                 # 数组/切片 Catch2 测试
│   ├── CMakeLists.txt
│   └── ArrayTest.cpp
├── defer/                 # defer Catch2 测试
│   ├── CMakeLists.txt
│   └── DeferTest.cpp
└── new_delete/            # new/delete Catch2 测试
    ├── CMakeLists.txt
    └── NewDeleteTest.cpp
```

---

## 测试方法

每个测试文件应包含：
1. **解析测试**：验证语法正确
2. **语义分析测试**：验证类型检查正确
3. **代码生成测试**：验证 LLVM IR 生成正确（可选）

---

## 优先级

1. **高优先级**：解析器和语义分析器的基础测试
2. **中优先级**：类系统、异常处理、数组/切片测试
3. **低优先级**：代码生成测试（需要运行 LLVM）
